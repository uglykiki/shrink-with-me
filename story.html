<!DOCTYPE html>
<html lang="ENG">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shrink with me</title>
	<script src="js/p5.min.js"></script>
	<script src="js/p5.js"></script>
	<script src="js/addons/p5.dom.js"></script>
	<script src="js/addons/p5.sound.js"></script>
	<script src="js/p5.speech.js"></script>
	<link rel="stylesheet" href="style.css">
	<link href="https://fonts.googleapis.com/css?family=Amatic+SC|Crimson+Text" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
<div class="tip">Please allow &nbsp;
    <i class="fa fa-microphone" ></i> 
    <br>and speak the following sentences......
</div>

<div class="live-story">
    <script>
        var songStress;
        var songRain;
        var songHelp;
        var songRun;
        var songKill;
        var songLaugh;
        var songBreath;
        var songCry;
        var myRec = new p5.SpeechRec('en-US', parseResult); // new P5.SpeechRec object
        myRec.continuous = true; // do continuous recognition
        myRec.interimResults = true; // allow partial recognition (faster, less accurate)
        var bg;
        
        // load musics
        function preload() {
            songStress = loadSound('assets/The-Alchemist.wav');
            songRain = loadSound('assets/rain.mp3');
            songHelp= loadSound('assets/help.wav');
            songRun = loadSound('assets/run.wav');
            songKill = loadSound('assets/kill.mp3');
            songBreath = loadSound('assets/breath.wav');
            songLaugh = loadSound('assets/laugh.wav');
            songCry = loadSound('assets/cry.wav');
        }
        
        function setup()
        {
            bg = loadImage("assets/diving2.jpg");
            //loop song//
            songStress.loop(); 
            createCanvas(1280, 600);
            
            // instructions:
            background(bg);
            fill(255, 255, 255);
            textSize(18);
            textFont('Georgia');
            textAlign(LEFT);
            text("I'm so stressed,", 80, 80);
            
            //myRec.onResult = parseResult; // now in the constructor
            myRec.start(); // start engine
            songStress = loadSound ('assets/The-Alchemist.mp3');
        }
        
        
        function parseResult()
        {
            // recognition system will often append words into phrases.
            // so hack here is to only use the last word:
            var mostrecentword = myRec.resultString.split(' ').pop();
            if(mostrecentword.indexOf("stressed")!==-1) { 
                //text
                text("I hope some one can hear me,", 80, 114);
                //change soung
                songCry.play();
            }
            else if(mostrecentword.indexOf("hear")!==-1) { 
                text("Can anybody see the light? ", 80, 144);

            }
            else if(mostrecentword.indexOf("light")!==-1) { 
                text("Why does it rain everyday?", 80, 174);
                songRain.play();
            }
            else if(mostrecentword.indexOf("everyday")!==-1) { 
                text("Why can't I breath normally?", 80, 204);
                
            }
            else if(mostrecentword.indexOf("breath")!==-1) { 
                text("I really really hate myself! ", 80, 234);
                songHelp.play();
            }
            else if(mostrecentword.indexOf("myself")!==-1) { 
                text("Sometimes I just want to escape,", 80, 264);
                songRun.play();
                
            }
            else if(mostrecentword.indexOf("escape")!==-1) { 
                text("have no reason....", 80, 294);
            }
            else if(mostrecentword.indexOf("reason")!==-1) { 
                text("Or I want to destroy something ugly", 80, 324);
                songKill.play();
            }
            
            else if(mostrecentword.indexOf("ugly")!==-1) { 
                text("Like my hell life", 80, 354);
                songBreath.play();
            }
            
            else if(mostrecentword.indexOf("life")!==-1) { 
                text("It makes me feel relieved.", 80, 384);
            }

            else if(mostrecentword.indexOf("relieved")!==-1) { 
                text("Am I strange?", 80, 414);
                songLaugh.play();
                
            }
            else if(mostrecentword.indexOf("strange?")!==-1) { 
                text("Are you afraid of me?", 80, 444);
            }
            else if(mostrecentword.indexOf("afraid")!==-1) { 
                text("Are you still listening?", 80, 474);
                songRun.play();
            }
            else if(mostrecentword.indexOf("listening")!==-1) { 
                text("I know you are leaving........", 80, 504);
            }
        }
    </script>
</div>
<div class="leave">
   <a onclick="myFunction()"><i class="fa fa-repeat"></i> Try Again</a> &nbsp;&nbsp;&nbsp;
   <a href="end.html">Leave â–¶</a>
   <script>
    function myFunction() {
        location.reload();
    }
    </script>

   
   
</div>



</body>
</html>
